{% extends 'base.html' %}

{% block title %}{% if session.get('lang','kor') == 'eng' %}Add Ingredient - Space Food Management System{% else %}식재료 추가 - 우주 식량 관리 시스템{% endif %}{% endblock %}

{% block content %}
    <h1>{% if session.get('lang','kor') == 'eng' %}Add Ingredient{% else %}식재료 (Ingredient) 추가{% endif %}</h1>
    <form method="POST">
        <label>{% if session.get('lang','kor') == 'eng' %}Name (multilingual):{% else %}이름 (다중 언어):{% endif %}</label><br>
        <div id="name-fields"></div>
        <button type="button" id="add-name-btn">{% if session.get('lang','kor') == 'eng' %}Add Name{% else %}이름 추가{% endif %}</button><br><br>

        <label for="research_ids">{% if session.get('lang','kor') == 'eng' %}Related Research IDs:{% else %}관련 연구 ID:{% endif %}</label><br>
        <select id="research_ids" name="research_ids" multiple size="5">
            {% for research in all_research %}
                <option value="{{ research.id }}">{{ research.reference_data.title }} (ID: {{ research.id }})</option>
            {% endfor %}
        </select><br><small>{% if session.get('lang','kor') == 'eng' %}Hold Ctrl or Shift to select multiple items{% else %}Ctrl 또는 Shift 키를 눌러 다중 선택할 수 있습니다{% endif %}</small><br><br>

        <label>{% if session.get('lang','kor') == 'eng' %}Nutritional Information (per unit mass):{% else %}영양소 정보 (단위 질량당):{% endif %}</label><br>
        <div id="nutrition-fields"></div>
        <button type="button" id="add-nutrition-btn">{% if session.get('lang','kor') == 'eng' %}Add Nutrient{% else %}영양소 추가{% endif %}</button><br>
        <small>{% if session.get('lang','kor') == 'eng' %}Enter the content per unit mass for each nutrient (e.g., calories, protein, vitamins etc.){% else %}각 영양소의 단위 질량당 함유량을 입력하세요. (예: 칼로리, 단백질, 비타민 등){% endif %}</small><br><br>

        <label for="production_time">{% if session.get('lang','kor') == 'eng' %}Production Time:{% else %}생산 소요 시간:{% endif %}</label><br>
        <input type="text" id="production_time" name="production_time"><br><br>

        <button type="submit">{% if session.get('lang','kor') == 'eng' %}Add{% else %}추가하기{% endif %}</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Dynamic language fields for name
                const addNameField = createDynamicLanguageFields('name-fields', 'name', '이름');
                document.getElementById('add-name-btn').addEventListener('click', addNameField);
            } catch (e) {
                console.error(e);
                alert('Error initializing name fields. Please refresh the page.');
            }

            // Dynamic nutrition fields
            const nutritionCategories = {{ nutrition_categories | tojson }};
            const nutritionFieldsContainer = document.getElementById('nutrition-fields');
            const addNutritionBtn = document.getElementById('add-nutrition-btn');

            function addNutritionField() {
                const fieldRow = document.createElement('div');
                fieldRow.className = 'nutrition-field-row';

                const select = document.createElement('select');
                select.name = 'nutrient_name';
                nutritionCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = `${category.name} (${category.unit})`;
                    select.appendChild(option);
                });

                const valueInput = document.createElement('input');
                valueInput.type = 'number';
                valueInput.step = 'any';
                valueInput.name = 'nutrient_value';
                valueInput.placeholder = '값';
                valueInput.required = true;

                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.textContent = '삭제';
                removeBtn.addEventListener('click', () => {
                    fieldRow.remove();
                });

                fieldRow.appendChild(select);
                fieldRow.appendChild(valueInput);
                fieldRow.appendChild(removeBtn);
                nutritionFieldsContainer.appendChild(fieldRow);
            }

            addNutritionBtn.addEventListener('click', addNutritionField);

            // Add one nutrition field by default
            addNutritionField();
        });
    </script>
{% endblock %}
