{% extends 'base.html' %}

{% block title %}Storaged Ingredient Visualization{% endblock %}

{% block content %}
<style>
    .ingredient-item {
        border-bottom: 1px solid #eee;
        padding-bottom: 24px;
        margin-bottom: 28px;
    }
    /* 게이지와 날짜 마커를 포함하는 컨테이너 */
    .progress-section {
        padding: 0 24px; /* 좌우 여백 */
        margin: 15px 0;
    }
    .progress-bar-container {
        width: 100%;
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin: 10px 0;
        position: relative;
        height: 20px;
        overflow: hidden;
    }
    /* 생산 중인 경우의 스타일 */
    .progress-bar-production {
        position: absolute;
        height: 100%;
        background-color: #4caf50; /* 초록색: 현재까지 진행 */
        transition: all 0.3s ease;
        z-index: 2;
    }
    .progress-bar-expected {
        position: absolute;
        height: 100%;
        background-color: #bbdefb; /* 연한 파란색: 예상 생산 구간 */
        transition: all 0.3s ease;
        z-index: 1;
    }
    /* 저장 중인 경우의 스타일 */
    .progress-bar-storage {
        position: absolute;
        height: 100%;
        background-color: #ff5252; /* 빨간색: 저장 진행 */
        transition: width 0.3s ease;
    }
    .progress-text {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #000;
        z-index: 1;
        font-size: 0.8em;
    }
    .date-markers {
        position: relative;
        width: 100%;
        height: 42px; /* increased to accommodate labels */
        margin-top: 8px;
        padding-bottom: 6px; /* extra space so labels don't hit container edge */
    }
    .date-marker {
        position: absolute;
        transform: translateX(-50%);
        font-size: 0.75em;
        color: #666;
        text-align: center;
        white-space: nowrap;
    }
    .date-marker::before {
        content: '';
        position: absolute;
        left: 50%;
        top: -8px;
        transform: translateX(-50%);
        border-left: 1px solid #666;
        height: 6px;
    }
    .date-marker.start { color: #2196F3; }
    .date-marker.current { color: #4CAF50; }
    .date-marker.end { color: #f44336; }
    .date-label {
        display: block;
        margin-bottom: 2px;
        font-size: 0.7em;
        font-weight: bold;
    }
</style>

<div style="display: flex; justify-content: space-between; align-items: center;">
    <h1>Storaged Ingredient Visualization</h1>
    <a href="{{ url_for('add_data.add_storaged_ingredient_route') }}" class="btn btn-primary">Add Storaged Ingredient</a>
</div>

{% for item in storaged_ingredients %}
<div class="ingredient-item">
    <h2>{{ item.name }}</h2>
    <p>Mass: {{ item.mass_g }}g</p>
    
    <p>Production/Storage Start: {{ item.start_date }}</p>
    <p>Expiration Date: {{ item.expiration_date }}</p>

    <div class="progress-section">
        <div class="progress-bar-container">
            {% if item.is_production %}
                <!-- 생산 중: single bar with three possible colored segments -->
                <!-- grey area: future gap between today and start (if start > today) -->
                <div class="progress-bar-expected" style="left: 0%; width: {{ item.grey_width }}%; background-color: #e0e0e0; z-index:1;"></div>
                <!-- sky-blue expected range -->
                <div class="progress-bar-expected" style="left: {{ item.expected_left }}%; width: {{ item.expected_width }}%; background-color: #bbdefb; z-index:1;"></div>
                <!-- green progress (from start to today) -->
                <div class="progress-bar-production" style="left: {{ item.green_left }}%; width: {{ item.green_width }}%;"></div>
                <div class="progress-text">{{ '%.1f'|format(item.green_width) }}% (생산 중)</div>
            {% else %}
                <!-- 저장 중인 경우 -->
                <div class="progress-bar-storage" style="width: {{ item.current_progress }}%;"></div>
                <div class="progress-text">{{ '%.1f'|format(item.current_progress) }}% (저장 중)</div>
            {% endif %}
        </div>
        <!-- 날짜 마커들 -->
        <div class="date-markers">
        {% if item.is_production %}
            <div class="date-marker start" style="left: {{ item.start_pos }}%">
                <span class="date-label">생산 시작</span>
                {{ item.start_date }}
            </div>
            <div class="date-marker current" style="left: {{ item.today_pos }}%">
                <span class="date-label">현재</span>
                {{ today }}
            </div>
            <div class="date-marker" style="left: {{ item.expected_left }}%">
                <span class="date-label">최소 예상</span>
                {{ item.min_end_date }}
            </div>
            <div class="date-marker end" style="left: 100%">
                <span class="date-label">최대 예상</span>
                {{ item.max_end_date }}
            </div>
        {% else %}
            <div class="date-marker start" style="left: 0%">
                <span class="date-label">저장 시작</span>
                {{ item.start_date }}
            </div>
            <div class="date-marker current" style="left: {{ item.current_progress }}%">
                <span class="date-label">현재</span>
                {{ today }}
            </div>
            <div class="date-marker end" style="left: 100%">
                <span class="date-label">유통기한</span>
                {{ item.expiration_date }}
            </div>
        {% endif %}
    </div>
</div>
{% endfor %}
{% endblock %}
