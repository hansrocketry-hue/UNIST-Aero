{% extends 'base.html' %}

{% block title %}보관 식재료 추가{% endblock %}

{% block content %}
    <h1>보관 식재료 (Storaged Ingredient) 추가</h1>
    <form method="POST">
        <div class="mode-selection">
            <label>모드 선택:</label><br>
            <input type="radio" id="mode_storage" name="mode" value="storage" checked>
            <label for="mode_storage">보관</label>
            <input type="radio" id="mode_production" name="mode" value="production">
            <label for="mode_production">생산</label><br><br>
        </div>

        <label for="storage_id">식재료 또는 요리 종류:</label><br>
        <select id="storage_id" name="storage_id" required>
            <option value="" disabled selected>-- 선택 --</option>
            <optgroup label="식재료">
                {% for ingredient in all_ingredients %}
                    <option value="{{ ingredient.id }}" 
                            data-min-time="{{ ingredient.production_time.min if ingredient.production_time.producible else '' }}" 
                            data-max-time="{{ ingredient.production_time.max if ingredient.production_time.producible else '' }}"
                            data-producible="{{ 'true' if ingredient.production_time.producible else 'false' }}">
                        {{ ingredient.name.kor }} (ID: {{ ingredient.id }})
                        {% if ingredient.production_time.producible %}
                            - 생산 시간: {{ ingredient.production_time.min }}~{{ ingredient.production_time.max }}일
                        {% endif %}
                    </option>
                {% endfor %}
            </optgroup>
            <optgroup label="요리">
                {% for dish in all_dishes %}
                    <option value="{{ dish.id }}" 
                            data-min-time="" 
                            data-max-time=""
                            data-producible="false">
                        {{ dish.name.kor }} (ID: {{ dish.id }})
                    </option>
                {% endfor %}
            </optgroup>
        </select><br><br>

        <label for="mass_g">보유 질량 (g):</label><br>
        <input type="number" id="mass_g" name="mass_g" required><br><br>

        <div class="dates-container">
            <label for="start_date">시작일:</label><br>
            <input type="date" id="start_date" name="start_date" required><br><br>

            <div id="production_dates" style="display:none;">
                <label>생산 예상 종료 범위:</label><br>
                <input type="date" id="min_end_date" name="min_end_date" readonly>
                <small>최소</small><br>
                <input type="date" id="max_end_date" name="max_end_date" readonly>
                <small>최대</small><br><br>
            </div>

            <div id="expiration_container" class="storage-only">
                <label for="expiration_date">보관 기한:</label><br>
                <input type="date" id="expiration_date" name="expiration_date"><br><br>
            </div>
        </div>

        <label for="processing_type">가공 방식 (Processing Method):</label><br>
        <select id="processing_type" name="processing_type" required>
            <option value="" disabled selected>-- 가공 방식 선택 --</option>
            <option value="T">T - Thermostabilized (멸균·열처리 완전조리식)</option>
            <option value="R">R - Rehydratable (동결건조·온수 재수화식)</option>
            <option value="I">I - Intermediate Moisture (반건식·즉석 섭취 가능)</option>
            <option value="N">N - Natural / Fresh (신선 과일·채소류)</option>
            <option value="B">B - Beverage / Paste (액상·튜브형)</option>
            <option value="F">F - Frozen / Baked (냉동 또는 오븐식)</option>
            <option value="G">G - Germinated / Fresh Cultivated (재배식)</option>
            <option value="P">P - Powdered / Nutrient Mix (분말형 영양식)</option>
        </select>
        <div id="processing_description" style="margin-top:6px; font-size:0.95em; color:#444">선택한 가공 방식에 대한 설명이 여기에 표시됩니다.</div>
        <br>

        <button type="submit">추가하기</button>
    </form>
    <script src="{{ url_for('static', filename='js/production_time_handler.js') }}"></script>
{% endblock %}
