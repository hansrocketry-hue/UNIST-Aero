<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대시보드 - 우주 음식 데이터베이스</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>우주 음식 데이터베이스 대시보드</h1>
            <p>안녕하세요, {{ username }}님! <a href="{{ url_for('logout') }}">로그아웃</a></p>
        </div>

        <!-- 입력 폼 섹션 -->
        <div class="forms-section">
            <!-- 연구 데이터 추가 폼 -->
            <div class="form-container">
                <h2>연구 데이터 추가</h2>
                <form action="{{ url_for('handle_add_research') }}" method="post">
                    <label for="data">출처 문서/링크:</label>
                    <input type="text" id="data" name="data" required>

                    <label for="summary_kor">요약 (Kor):</label>
                    <textarea id="summary_kor" name="summary_kor" required></textarea>

                    <label for="summary_eng">요약 (Eng):</label>
                    <textarea id="summary_eng" name="summary_eng" required></textarea>

                    <button type="submit">연구 추가</button>
                </form>
            </div>

            <!-- 1차 가공 음식 추가 폼 -->
            <div class="form-container">
                <h2>1차 가공 음식 추가</h2>
                <form action="{{ url_for('handle_add_foods_first') }}" method="post">
                    <label for="name_kor_ff">이름 (Kor):</label>
                    <input type="text" id="name_kor_ff" name="name_kor" required>

                    <label for="name_eng_ff">이름 (Eng):</label>
                    <input type="text" id="name_eng_ff" name="name_eng" required>

                    <label for="research_ids_ff">관련 연구:</label>
                    <select id="research_ids_ff" name="research_ids" multiple required>
                        {% for research in db.research_data %}
                            <option value="{{ research.id }}">{{ research.id }}: {{ research.summary.kor[:30] }}...</option>
                        {% endfor %}
                    </select>

                    <label for="nutrients_per_unit_mass">단위 질량당 영양성분 (JSON):</label>
                    <input type="text" id="nutrients_per_unit_mass" name="nutrients_per_unit_mass" placeholder='{"protein": 10, "fat": 5}'>

                    <label for="calories">칼로리:</label>
                    <input type="number" step="0.01" id="calories" name="calories">

                    <button type="submit">1차 음식 추가</button>
                </form>
            </div>

            <!-- 조리 방법 추가 폼 -->
            <div class="form-container">
                <h2>조리 방법 추가</h2>
                <form action="{{ url_for('handle_add_cooking_method') }}" method="post">
                    <label for="name_kor_cm">이름 (Kor):</label>
                    <input type="text" id="name_kor_cm" name="name_kor" required>

                    <label for="name_eng_cm">이름 (Eng):</label>
                    <input type="text" id="name_eng_cm" name="name_eng" required>

                    <label for="description_kor">설명 (Kor):</label>
                    <textarea id="description_kor" name="description_kor" required></textarea>

                    <label for="description_eng">설명 (Eng):</label>
                    <textarea id="description_eng" name="description_eng" required></textarea>

                    <label for="research_ids_cm">관련 연구:</label>
                    <select id="research_ids_cm" name="research_ids" multiple required>
                        {% for research in db.research_data %}
                            <option value="{{ research.id }}">{{ research.id }}: {{ research.summary.kor[:30] }}...</option>
                        {% endfor %}
                    </select>

                    <button type="submit">조리법 추가</button>
                </form>
            </div>

            <!-- 2차 가공 음식 추가 폼 -->
            <div class="form-container">
                <h2>2차 가공 음식 추가</h2>
                <form action="{{ url_for('handle_add_foods_second') }}" method="post">
                    <label for="name_kor_fs">이름 (Kor):</label>
                    <input type="text" id="name_kor_fs" name="name_kor" required>

                    <label for="name_eng_fs">이름 (Eng):</label>
                    <input type="text" id="name_eng_fs" name="name_eng" required>

                    <label for="required_ingredient_ids">요구 재료:</label>
                    <select id="required_ingredient_ids" name="required_ingredient_ids" multiple required>
                        {% for food in db['foods-first'] %}
                            <option value="{{ food.id }}">{{ food.name.kor }}</option>
                        {% endfor %}
                    </select>

                    <label for="required_cooking_method_ids">요구 조리법:</label>
                    <select id="required_cooking_method_ids" name="required_cooking_method_ids" multiple required>
                        {% for method in db.cooking_methods %}
                            <option value="{{ method.id }}">{{ method.name.kor }}</option>
                        {% endfor %}
                    </select>

                    <label for="image_url_fs">이미지 URL:</label>
                    <input type="text" id="image_url_fs" name="image_url">

                    <button type="submit">2차 음식 추가</button>
                </form>
            </div>
        </div>

        <!-- 데이터 테이블 섹션 -->
        <div class="tables-section">
            <!-- 2차 가공 음식 테이블 -->
            <h2>2차 가공 음식</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>이름 (Kor)</th>
                        <th>이름 (Eng)</th>
                        <th>재료 ID</th>
                        <th>조리법 ID</th>
                        <th>이미지</th>
                    </tr>
                </thead>
                <tbody>
                    {% for food in db['foods-second'] %}
                    <tr>
                        <td>{{ food.id }}</td>
                        <td>{{ food.name.kor }}</td>
                        <td>{{ food.name.eng }}</td>
                        <td>{{ food.required_ingredient_ids | join(', ') }}</td>
                        <td>{{ food.required_cooking_method_ids | join(', ') }}</td>
                        <td><a href="{{ food.image_url }}" target="_blank">Link</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- 1차 가공 음식 테이블 -->
            <h2>1차 가공 음식</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>이름 (Kor)</th>
                        <th>이름 (Eng)</th>
                        <th>연구 ID</th>
                        <th>영양 정보</th>
                    </tr>
                </thead>
                <tbody>
                    {% for food in db['foods-first'] %}
                    <tr>
                        <td>{{ food.id }}</td>
                        <td>{{ food.name.kor }}</td>
                        <td>{{ food.name.eng }}</td>
                        <td>{{ food.research_ids | join(', ') }}</td>
                        <td>{{ food.nutrition_info | tojson }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- 조리 방법 테이블 -->
            <h2>조리 방법</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>이름 (Kor)</th>
                        <th>이름 (Eng)</th>
                        <th>설명 (Kor)</th>
                        <th>설명 (Eng)</th>
                        <th>연구 ID</th>
                    </tr>
                </thead>
                <tbody>
                    {% for method in db.cooking_methods %}
                    <tr>
                        <td>{{ method.id }}</td>
                        <td>{{ method.name.kor }}</td>
                        <td>{{ method.name.eng }}</td>
                        <td>{{ method.description.kor }}</td>
                        <td>{{ method.description.eng }}</td>
                        <td>{{ method.research_ids | join(', ') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- 연구 데이터 테이블 -->
            <h2>연구 데이터</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>데이터</th>
                        <th>요약 (Kor)</th>
                        <th>요약 (Eng)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for research in db.research_data %}
                    <tr>
                        <td>{{ research.id }}</td>
                        <td>{{ research.data }}</td>
                        <td>{{ research.summary.kor }}</td>
                        <td>{{ research.summary.eng }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>